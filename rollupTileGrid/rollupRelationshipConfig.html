<template>
    <lightning-card title="Rollup Relationship Configuration" icon-name="standard:link">
        <!-- Loading overlay -->
        <template if:true={isLoading}>
            <lightning-spinner
                alternative-text="Loading configuration"
                size="small"
                variant="brand">
            </lightning-spinner>
        </template>

        <div class="slds-p-around_medium">
            <!-- Error message -->
            <template if:true={hasError}>
                <div class="slds-text-color_error slds-m-bottom_small slds-text-body_small">
                    {loadError}
                </div>
            </template>

            <!-- Intro text -->
            <p class="slds-text-body_small slds-m-bottom_medium">
                Choose how this rollup relates to <strong>{parentObjectApiName}</strong>.
                The options update automatically based on your selections.
            </p>

            <!-- Child configuration -->
            <div class="slds-m-bottom_large">
                <h2 class="slds-text-title_caps slds-m-bottom_small">
                    Child relationship
                </h2>

                <lightning-combobox
                    name="childObject"
                    label="Child Object"
                    placeholder="Select a child object"
                    value={childObjectValue}
                    options={childObjectOptions}
                    onchange={handleChildObjectChange}
                    required>
                </lightning-combobox>

                <lightning-combobox
                    class="slds-m-top_small"
                    name="childRelationshipField"
                    label="Relationship Field (lookup on child)"
                    placeholder="Select lookup field on child"
                    value={childRelationshipFieldValue}
                    options={childRelationshipFieldOptions}
                    onchange={handleChildRelationshipFieldChange}
                    disabled={isChildRelationshipDisabled}>
                </lightning-combobox>
            </div>

            <!-- Grandchild configuration -->
            <div class="slds-m-bottom_large">
                <h2 class="slds-text-title_caps slds-m-bottom_small">
                    Grandchild relationship (optional)
                </h2>

                <p class="slds-text-body_small slds-m-bottom_small">
                    Use these if your rollup needs to reach one more level down
                    (grandchild records). Leave them blank if you only need a
                    single-level child rollup.
                </p>

                <lightning-combobox
                    name="grandchildObject"
                    label="Grandchild Object (optional)"
                    placeholder="Select a grandchild object"
                    value={grandchildObjectValue}
                    options={grandchildObjectOptions}
                    onchange={handleGrandchildObjectChange}
                    disabled={isGrandchildPicklistsDisabled}>
                </lightning-combobox>

                <lightning-combobox
                    class="slds-m-top_small"
                    name="grandchildRelationshipField"
                    label="Relationship Field (lookup on grandchild) (optional)"
                    placeholder="Select lookup field on grandchild"
                    value={grandchildRelationshipFieldValue}
                    options={grandchildRelationshipFieldOptions}
                    onchange={handleGrandchildRelationshipFieldChange}
                    disabled={isGrandchildRelationshipDisabled}>
                </lightning-combobox>
            </div>

            <!-- Actions -->
            <div class="slds-m-top_medium slds-text-align_right">
                <lightning-button
                    variant="brand"
                    label="Save"
                    onclick={handleSaveClick}>
                </lightning-button>
            </div>
        </div>
    </lightning-card>
</template>
